import { requestData } from "./request";

let savedFetch = global.fetch;

describe("request", () => {
  beforeEach(() => {
    global.fetch = jest.fn(() =>
      Promise.resolve({
        ok: true,
        json: () => Promise.resolve(dummyData),
      } as Response)
    );
  });

  afterEach(() => {
    global.fetch = savedFetch;
  });

  it("returns filtered rows", async () => {
    const data = await requestData({
      attributeIds: [1],
      countryIds: [49, 70],
      allCountries: false,
      allCountriesInRegionIds: [],
      yearIds: [1, 2, 3],
      allYears: false,
    });
    expect(data.length).toBe(6);
    expect(data).toStrictEqual([
      {
        Year: "2022",
        Country: "Afghanistan",
        Region: "Eastern Mediterranean Region",
        "Obesity, Children (5-9 yr)": 9.56
      },
      {
        Year: "2021",
        Country: "Afghanistan",
        Region: "Eastern Mediterranean Region",
        "Obesity, Children (5-9 yr)": 8.9
      },
      {
        Year: "2020",
        Country: "Afghanistan",
        Region: "Eastern Mediterranean Region",
        "Obesity, Children (5-9 yr)": 8.27
      },
      {
        Year: "2022",
        Country: "Albania",
        Region: "European Region",
        "Obesity, Children (5-9 yr)": 11.23
      },
      {
        Year: "2021",
        Country: "Albania",
        Region: "European Region",
        "Obesity, Children (5-9 yr)": 10.95
      },
      {
        Year: "2020",
        Country: "Albania",
        Region: "European Region",
        "Obesity, Children (5-9 yr)": 10.68
      }
    ]);
  });
});

const dummyData = [
  [4, 49, 1, 7.81],
  [1, 49, 1, 9.56],
  [4, 49, 2, 7.22],
  [1, 49, 2, 8.9],
  [4, 49, 3, 6.67],
  [1, 49, 3, 8.27],
  [4, 49, 4, 6.15],
  [1, 49, 4, 7.67],
  [4, 49, 5, 5.66],
  [1, 49, 5, 7.1],
  [4, 49, 6, 5.21],
  [1, 49, 6, 6.56],
  [4, 49, 7, 4.79],
  [1, 49, 7, 6.06],
  [4, 49, 8, 4.41],
  [1, 49, 8, 5.6],
  [4, 49, 9, 4.06],
  [1, 49, 9, 5.18],
  [4, 49, 10, 3.75],
  [1, 49, 10, 4.8],
  [4, 49, 11, 3.47],
  [1, 49, 11, 4.45],
  [4, 49, 12, 3.21],
  [1, 49, 12, 4.13],
  [4, 49, 13, 2.98],
  [1, 49, 13, 3.84],
  [4, 49, 14, 2.76],
  [1, 49, 14, 3.56],
  [4, 49, 15, 2.55],
  [1, 49, 15, 3.31],
  [4, 49, 16, 2.36],
  [1, 49, 16, 3.07],
  [4, 49, 17, 2.18],
  [1, 49, 17, 2.84],
  [4, 49, 18, 2.01],
  [1, 49, 18, 2.63],
  [4, 49, 19, 1.85],
  [1, 49, 19, 2.44],
  [4, 49, 20, 1.71],
  [1, 49, 20, 2.26],
  [4, 49, 21, 1.57],
  [1, 49, 21, 2.09],
  [4, 49, 22, 1.45],
  [1, 49, 22, 1.93],
  [4, 49, 23, 1.34],
  [1, 49, 23, 1.79],
  [4, 49, 24, 1.23],
  [1, 49, 24, 1.66],
  [4, 49, 25, 1.14],
  [1, 49, 25, 1.54],
  [4, 49, 26, 1.05],
  [1, 49, 26, 1.43],
  [4, 49, 27, 0.98],
  [1, 49, 27, 1.34],
  [4, 49, 28, 0.91],
  [1, 49, 28, 1.25],
  [4, 49, 29, 0.85],
  [1, 49, 29, 1.17],
  [4, 49, 30, 0.79],
  [1, 49, 30, 1.1],
  [4, 49, 31, 0.74],
  [1, 49, 31, 1.04],
  [4, 49, 32, 0.7],
  [1, 49, 32, 0.98],
  [4, 49, 33, 0.66],
  [1, 49, 33, 0.92],
  [1, 70, 1, 11.23],
  [4, 70, 1, 5.83],
  [1, 70, 2, 10.95],
  [4, 70, 2, 5.6],
  [1, 70, 3, 10.68],
  [4, 70, 3, 5.4],
  [1, 70, 4, 10.41],
  [4, 70, 4, 5.2],
  [1, 70, 5, 10.15],
  [4, 70, 5, 5.02],
  [4, 70, 6, 4.87],
  [1, 70, 6, 9.9],
  [4, 70, 7, 4.72],
  [1, 70, 7, 9.67],
  [4, 70, 8, 4.58],
  [1, 70, 8, 9.46],
  [4, 70, 9, 4.46],
  [1, 70, 9, 9.25],
  [4, 70, 10, 4.34],
  [1, 70, 10, 9.04],
  [4, 70, 11, 4.22],
  [1, 70, 11, 8.82],
  [4, 70, 12, 4.1],
  [1, 70, 12, 8.59],
  [4, 70, 13, 3.98],
  [1, 70, 13, 8.33],
  [4, 70, 14, 3.85],
  [1, 70, 14, 8.05],
  [4, 70, 15, 3.71],
  [1, 70, 15, 7.75],
  [4, 70, 16, 3.57],
  [1, 70, 16, 7.45],
  [4, 70, 17, 3.42],
  [1, 70, 17, 7.13],
  [4, 70, 18, 3.27],
  [1, 70, 18, 6.82],
  [4, 70, 19, 3.13],
  [1, 70, 19, 6.52],
  [4, 70, 20, 2.99],
  [1, 70, 20, 6.24],
  [4, 70, 21, 2.86],
  [1, 70, 21, 5.98],
  [4, 70, 22, 2.74],
  [1, 70, 22, 5.74],
  [4, 70, 23, 2.63],
  [1, 70, 23, 5.52],
  [4, 70, 24, 2.52],
  [1, 70, 24, 5.31],
  [4, 70, 25, 2.43],
  [1, 70, 25, 5.12],
  [4, 70, 26, 2.33],
  [1, 70, 26, 4.94],
  [4, 70, 27, 2.24],
  [1, 70, 27, 4.78],
  [4, 70, 28, 2.15],
  [1, 70, 28, 4.62],
  [4, 70, 29, 2.06],
  [1, 70, 29, 4.46],
  [4, 70, 30, 1.98],
  [1, 70, 30, 4.32],
  [4, 70, 31, 1.9],
  [1, 70, 31, 4.18],
  [4, 70, 32, 1.83],
  [1, 70, 32, 4.04],
  [4, 70, 33, 1.77],
  [1, 70, 33, 3.91],
  [4, 1, 1, 14.74],
  [1, 1, 1, 16.06],
  [4, 1, 2, 14.25],
  [1, 1, 2, 15.57],
  [4, 1, 3, 13.76],
  [1, 1, 3, 15.09],
  [4, 1, 4, 13.28],
  [1, 1, 4, 14.61],
  [4, 1, 5, 12.8],
  [1, 1, 5, 14.15],
  [4, 1, 6, 12.34],
  [1, 1, 6, 13.7],
  [4, 1, 7, 11.88],
  [1, 1, 7, 13.26],
  [4, 1, 8, 11.44],
  [1, 1, 8, 12.84],
  [4, 1, 9, 11.04],
  [1, 1, 9, 12.45],
  [4, 1, 10, 10.66],
  [1, 1, 10, 12.09],
  [4, 1, 11, 10.33],
  [1, 1, 11, 11.76],
  [4, 1, 12, 10.02],
  [1, 1, 12, 11.44],
  [1, 1, 13, 11.13],
  [4, 1, 13, 9.74],
  [1, 1, 14, 10.83],
  [4, 1, 14, 9.47],
  [1, 1, 15, 10.53],
  [4, 1, 15, 9.21],
  [1, 1, 16, 10.22],
  [4, 1, 16, 8.93],
  [4, 1, 17, 8.65],
  [1, 1, 17, 9.9],
  [4, 1, 18, 8.36],
  [1, 1, 18, 9.58],
  [4, 1, 19, 8.06],
  [1, 1, 19, 9.25],
  [4, 1, 20, 7.75],
  [1, 1, 20, 8.91],
  [4, 1, 21, 7.45],
  [1, 1, 21, 8.58],
  [4, 1, 22, 7.15],
  [1, 1, 22, 8.24],
  [4, 1, 23, 6.85],
  [1, 1, 23, 7.91],
  [4, 1, 24, 6.56],
  [1, 1, 24, 7.58],
  [4, 1, 25, 6.27],
  [1, 1, 25, 7.26],
  [4, 1, 26, 6.01],
  [1, 1, 26, 6.95],
  [4, 1, 27, 5.75],
  [1, 1, 27, 6.66],
  [4, 1, 28, 5.5],
  [1, 1, 28, 6.38],
  [4, 1, 29, 5.25],
  [1, 1, 29, 6.11],
  [4, 1, 30, 5.01],
  [1, 1, 30, 5.85],
  [4, 1, 31, 4.77],
  [1, 1, 31, 5.59],
  [4, 1, 32, 4.53],
  [1, 1, 32, 5.33],
  [4, 1, 33, 4.3],
  [1, 1, 33, 5.08],
  [1, 189, 1, 24.69],
  [4, 189, 1, 31.45],
  [1, 189, 2, 23.96],
  [4, 189, 2, 30.66],
  [1, 189, 3, 23.22],
  [4, 189, 3, 29.87],
  [1, 189, 4, 22.44],
  [4, 189, 4, 29.08],
  [1, 189, 5, 21.66],
  [4, 189, 5, 28.3],
  [1, 189, 6, 20.93],
  [4, 189, 6, 27.53],
  [1, 189, 7, 20.23],
  [4, 189, 7, 26.76],
  [1, 189, 8, 19.56],
  [4, 189, 8, 26],
  [1, 189, 9, 18.95],
  [4, 189, 9, 25.26],
  [1, 189, 10, 18.36],
  [4, 189, 10, 24.53],
  [1, 189, 11, 17.77],
  [4, 189, 11, 23.81],
  [1, 189, 12, 17.15],
  [4, 189, 12, 23.09],
  [1, 189, 13, 16.53],
  [4, 189, 13, 22.36],
  [1, 189, 14, 15.87],
  [4, 189, 14, 21.6],
  [1, 189, 15, 15.21],
  [4, 189, 15, 20.84],
  [1, 189, 16, 14.56],
  [4, 189, 16, 20.08],
  [1, 189, 17, 13.95],
  [4, 189, 17, 19.33],
  [1, 189, 18, 13.36],
  [4, 189, 18, 18.62],
  [1, 189, 19, 12.8],
  [4, 189, 19, 17.95],
  [1, 189, 20, 12.25],
  [4, 189, 20, 17.3],
  [1, 189, 21, 11.73],
  [4, 189, 21, 16.68],
  [1, 189, 22, 11.22],
  [4, 189, 22, 16.09],
  [1, 189, 23, 10.72],
  [4, 189, 23, 15.51],
  [1, 189, 24, 10.24],
  [4, 189, 24, 14.94],
  [4, 189, 25, 14.4],
  [1, 189, 25, 9.77],
  [4, 189, 26, 13.87],
  [1, 189, 26, 9.33],
  [4, 189, 27, 13.36],
  [1, 189, 27, 8.9],
  [4, 189, 28, 12.86],
  [1, 189, 28, 8.5],
  [4, 189, 29, 12.39],
  [1, 189, 29, 8.11],
  [4, 189, 30, 11.93],
  [1, 189, 30, 7.74],
  [4, 189, 31, 11.5],
  [1, 189, 31, 7.38],
  [4, 189, 32, 11.08],
  [1, 189, 32, 7.03],
  [4, 189, 33, 10.68],
  [1, 189, 33, 6.7],
  [1, 71, 1, 14.1],
  [4, 71, 1, 9.92],
  [1, 71, 2, 14.03],
  [4, 71, 2, 9.85],
  [1, 71, 3, 13.97],
  [4, 71, 3, 9.79],
  [1, 71, 4, 13.9],
  [4, 71, 4, 9.72],
  [1, 71, 5, 13.85],
  [4, 71, 5, 9.63],
  [1, 71, 6, 13.82],
  [4, 71, 6, 9.57],
  [1, 71, 7, 13.8],
  [4, 71, 7, 9.54],
  [1, 71, 8, 13.8],
  [4, 71, 8, 9.53],
  [1, 71, 9, 13.82],
  [4, 71, 9, 9.55],
  [1, 71, 10, 13.81],
  [4, 71, 10, 9.58],
  [1, 71, 11, 13.78],
  [4, 71, 11, 9.59],
  [1, 71, 12, 13.72],
  [4, 71, 12, 9.55],
  [1, 71, 13, 13.63],
  [4, 71, 13, 9.48],
  [1, 71, 14, 13.51],
  [4, 71, 14, 9.38],
  [1, 71, 15, 13.36],
  [4, 71, 15, 9.26],
  [1, 71, 16, 13.16],
  [4, 71, 16, 9.11],
  [1, 71, 17, 12.93],
  [4, 71, 17, 8.92],
  [1, 71, 18, 12.67],
  [4, 71, 18, 8.66],
  [1, 71, 19, 12.4],
  [4, 71, 19, 8.38],
  [1, 71, 20, 12.12],
  [4, 71, 20, 8.11],
  [1, 71, 21, 11.83],
  [4, 71, 21, 7.86],
  [1, 71, 22, 11.51],
  [4, 71, 22, 7.63],
  [1, 71, 23, 11.17],
  [4, 71, 23, 7.37],
  [1, 71, 24, 10.82],
  [4, 71, 24, 7.09],
  [1, 71, 25, 10.48],
  [4, 71, 25, 6.81],
  [1, 71, 26, 10.14],
  [4, 71, 26, 6.54],
  [4, 71, 27, 6.27],
  [1, 71, 27, 9.8],
  [4, 71, 28, 6.01],
  [1, 71, 28, 9.46],
  [4, 71, 29, 5.75],
  [1, 71, 29, 9.12],
  [4, 71, 30, 5.51],
  [1, 71, 30, 8.78],
  [4, 71, 31, 5.3],
  [1, 71, 31, 8.46],
  [4, 71, 32, 5.11],
  [1, 71, 32, 8.14],
  [4, 71, 33, 4.92],
  [1, 71, 33, 7.84],
];
